<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sama | AI Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-container {
            flex: 1;
            display: flex;
            max-width: 1200px;
            width: 100%;
            margin: 80px auto 20px;
            gap: 20px;
            padding: 0 20px;
        }

        .chat-sidebar {
            width: 300px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(var(--glass-blur));
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            padding: 20px;
            display: none;
            /* Hidden on mobile */
        }

        @media (min-width: 768px) {
            .chat-sidebar {
                display: flex;
            }
        }

        .sidebar-header {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-main);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .new-chat-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.3s;
        }

        .new-chat-btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            padding: 12px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.03);
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid transparent;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--glass-border);
        }

        .history-item.active {
            background: rgba(139, 92, 246, 0.1);
            border-color: var(--primary);
        }

        .main-chat {
            flex: 1;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(var(--glass-blur));
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bot-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .chat-info h2 {
            font-size: 1.1rem;
            margin: 0;
        }

        .chat-info span {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .messages-list {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        /* Custom Scrollbar */
        .messages-list::-webkit-scrollbar {
            width: 6px;
        }

        .messages-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
        }

        .messages-list::-webkit-scrollbar-thumb {
            background: var(--glass-border);
            border-radius: 10px;
        }

        .messages-list::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 20px;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        .message.bot {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-bottom-left-radius: 5px;
        }

        .message.user {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.2);
        }

        .input-wrapper {
            display: flex;
            gap: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 10px 20px;
            border-radius: 15px;
            align-items: center;
            transition: 0.3s;
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.2);
        }

        #message-input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            padding: 10px 0;
            font-family: var(--font-body);
            font-size: 1rem;
            outline: none;
        }

        #send-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
        }

        #send-btn:hover {
            transform: scale(1.1);
            background: var(--accent);
        }

        .back-btn {
            position: absolute;
            left: 20px;
            top: 25px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            z-index: 10;
        }

        .back-btn:hover {
            color: var(--text-main);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            width: fit-content;
            margin-bottom: 20px;
        }

        .dot-pulse {
            display: flex;
            gap: 5px;
        }

        .dot-pulse div {
            width: 8px;
            height: 8px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: pulse 1.5s infinite ease-in-out;
        }

        .dot-pulse div:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot-pulse div:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="background-glow"></div>

    <header class="glass-header">
        <nav>
            <div class="logo">Sama<span class="dot">.</span></div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#dashboard">Dashboard</a></li>
                <li><a href="settings.html">Settings</a></li>
            </ul>
        </nav>
    </header>

    <div class="chat-container">
        <aside class="chat-sidebar">
            <div class="sidebar-header">
                Chats
                <button class="new-chat-btn">+ New</button>
            </div>
            <div class="chat-history">
                <div class="history-item active">
                    <div style="font-weight: 600;">Welcome Chat</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">Just now</div>
                </div>
                <div class="history-item">
                    <div style="font-weight: 600;">Project Ideas</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">2 hours ago</div>
                </div>
                <div class="history-item">
                    <div style="font-weight: 600;">Code Help</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">Yesterday</div>
                </div>
            </div>
        </aside>

        <main class="main-chat">
            <a href="index.html" class="back-btn">‚Üê Back</a>
            <div class="chat-header">
                <div class="bot-avatar">S</div>
                <div class="chat-info">
                    <h2>Sama AI</h2>
                    <span>Online</span>
                </div>
            </div>

            <div class="messages-list" id="messages-list">
                <div class="message bot">
                    Hello! I'm Sama AI. How can I help you build something amazing today?
                </div>
            </div>

            <div class="typing-indicator" id="typing-indicator">
                <div class="dot-pulse">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>

            <div class="chat-input-area">
                <form id="chat-form">
                    <div class="input-wrapper">
                        <input type="text" id="message-input" placeholder="Type your message..." autocomplete="off">
                        <button type="submit" id="send-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const messagesList = document.getElementById('messages-list');
        const typingIndicator = document.getElementById('typing-indicator');

        // Login state check
        document.addEventListener('DOMContentLoaded', () => {
            const savedUser = localStorage.getItem('sama_user');
            const navLinks = document.querySelector('.nav-links');

            if (savedUser) {
                const userData = JSON.parse(savedUser);
                const li = document.createElement('li');
                li.style.color = 'var(--primary)';
                li.style.fontWeight = '600';
                li.style.display = 'flex';
                li.style.alignItems = 'center';
                li.style.gap = '10px';

                let userInfo = `<span>Welcome, ${userData.name || userData.email.split('@')[0]}</span>`;
                if (userData.role) {
                    userInfo += `<span style="font-size: 0.7rem; background: ${userData.role === 'Pro' ? 'var(--accent)' : 'var(--primary)'}; color: white; padding: 2px 8px; border-radius: 50px; text-transform: uppercase;">${userData.role}</span>`;
                }
                li.innerHTML = userInfo;
                navLinks.appendChild(li);

                const logoutLi = document.createElement('li');
                logoutLi.innerHTML = '<a href="#" id="logout-btn" style="color: var(--text-muted); font-size: 0.8rem;">Logout</a>';
                navLinks.appendChild(logoutLi);

                document.getElementById('logout-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    localStorage.removeItem('sama_user');
                    window.location.href = 'index.html';
                });
            }
        });

        const botResponses = [
            "That sounds like a great idea! How do you plan to implement it?",
            "I can help with that. Are you using any specific framework?",
            "Interesting! Sama is all about empowering creators like you.",
            "Let's break that down into smaller steps. What's the first thing you want to achieve?",
            "I'm here to assist with design, code, or just brainstorming.",
            "Wow, you're making great progress!",
            "Have you considered adding some animations to make it feel more dynamic?"
        ];

        let lastMessageCount = 0;

        function addMessage(text, sender, isHistory = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);

            if (sender === 'admin') {
                messageDiv.classList.add('bot'); // Admin looks like bot but with label
                messageDiv.innerHTML = `<span style="display:block; font-size: 0.7rem; color: var(--accent); font-weight: bold; margin-bottom: 5px;">Sama Admin</span> ${text}`;
            } else {
                messageDiv.textContent = text;
            }

            messagesList.appendChild(messageDiv);

            // Auto-scroll to bottom
            setTimeout(() => {
                messagesList.scrollTop = messagesList.scrollHeight;
            }, 100);

            if (!isHistory) {
                saveMessageToHistory(text, sender);
            }
        }

        function saveMessageToHistory(text, sender) {
            const savedUser = localStorage.getItem('sama_user');
            if (!savedUser) return;

            const userData = JSON.parse(savedUser);
            const userKey = userData.email || 'anonymous';

            let allChats = JSON.parse(localStorage.getItem('sama_all_chats') || '{}');

            if (!allChats[userKey]) {
                allChats[userKey] = {
                    name: userData.name || userData.email.split('@')[0],
                    email: userData.email,
                    messages: [],
                    takeover: false
                };
            }

            allChats[userKey].messages.push({
                text: text,
                sender: sender,
                timestamp: new Date().toISOString()
            });

            localStorage.setItem('sama_all_chats', JSON.stringify(allChats));
        }

        function checkForNewMessages() {
            const savedUser = localStorage.getItem('sama_user');
            if (!savedUser) return;
            const userData = JSON.parse(savedUser);
            const userKey = userData.email || 'anonymous';

            const allChats = JSON.parse(localStorage.getItem('sama_all_chats') || '{}');
            const chat = allChats[userKey];

            if (chat && chat.messages && chat.messages.length > lastMessageCount) {
                // If the new messages were sent by admin, we need to show them
                for (let i = lastMessageCount; i < chat.messages.length; i++) {
                    const msg = chat.messages[i];
                    if (msg.sender === 'admin') {
                        addMessage(msg.text, 'admin', true);
                    }
                }
                lastMessageCount = chat.messages.length;
            }
        }

        // Initial message count and history loading
        const initialUserData = localStorage.getItem('sama_user');
        if (initialUserData) {
            const userData = JSON.parse(initialUserData);
            const key = userData.email || 'anonymous';
            const allChats = JSON.parse(localStorage.getItem('sama_all_chats') || '{}');

            if (allChats[key] && allChats[key].messages) {
                messagesList.innerHTML = ''; // Clear the default welcome message
                allChats[key].messages.forEach(msg => {
                    const messageDiv = document.createElement('div');
                    messageDiv.classList.add('message', msg.sender === 'user' ? 'user' : 'bot');

                    if (msg.sender === 'admin') {
                        messageDiv.innerHTML = `<span style="display:block; font-size: 0.7rem; color: var(--accent); font-weight: bold; margin-bottom: 5px;">Sama Admin</span> ${msg.text}`;
                    } else {
                        messageDiv.textContent = msg.text;
                    }
                    messagesList.appendChild(messageDiv);
                });
                lastMessageCount = allChats[key].messages.length;
                messagesList.scrollTop = messagesList.scrollHeight;
            }
        }

        // New Chat Button
        document.querySelector('.new-chat-btn').addEventListener('click', () => {
            if (confirm('Start a new chat session? This will clear the screen but your history is saved.')) {
                messagesList.innerHTML = '<div class="message bot">New session started. How can I help you?</div>';
                // We keep the history in localStorage but clear the current view
                // Optionally, you could clear the history here if desired, 
                // but the user asked to "save messages" on close, implying history is important.
            }
        });

        setInterval(checkForNewMessages, 2000);

        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const text = messageInput.value.trim();
            if (!text) return;

            addMessage(text, 'user');
            messageInput.value = '';

            const savedUserData = localStorage.getItem('sama_user');
            const userData = JSON.parse(savedUserData);
            const userKey = userData.email || 'anonymous';
            const allChats = JSON.parse(localStorage.getItem('sama_all_chats') || '{}');

            // If admin has taken over, don't trigger bot response
            if (allChats[userKey] && allChats[userKey].takeover) {
                return;
            }

            // Show typing indicator
            typingIndicator.style.display = 'block';
            messagesList.scrollTop = messagesList.scrollHeight;

            // Simulate bot response
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                const randomResponse = botResponses[Math.floor(Math.random() * botResponses.length)];
                addMessage(randomResponse, 'bot');
            }, 1500);
        });
    </script>
</body>

</html>